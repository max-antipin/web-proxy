version: '3.8'
name: web-proxy-dev
services:
  php:
#    container_name: dolly-php-dev
    build:
      context: .
      dockerfile: ./docker/php.Dockerfile
    image: max-antipin/${COMPOSE_PROJECT_NAME}-php
    restart: unless-stopped
    volumes:
      - .:/var/www/html/
  webserver:
#    build:
#      args:
#        - NGINX_VER: alpine
#      context: .
#      dockerfile: ./docker/nginx.Dockerfile
#    container_name: dolly-nginx-dev
    depends_on:
      - php
    environment:
      - SERVER_NAME=dolly-proxy.local
      - DOLLY_SERVER_NAME=dolly-sites.local
#    env_file:
#      - ./.app.env
    image: nginx:alpine
    ports:
      - target: 80
        published: ${HTTP_PORT:-80}
        protocol: tcp
      - target: 443
        published: ${HTTPS_PORT:-443}
        protocol: tcp
      - target: 443
        published: ${HTTP3_PORT:-443}
        protocol: udp
#    read_only: true
    restart: unless-stopped
    volumes:
      - ./docker/nginx/default.conf.template:/etc/nginx/templates/default.conf.template:ro
      - ./docker/nginx/x-catch-all.conf:/etc/nginx/conf.d/x-catch-all.conf:ro
#      - ./docker/nginx/x-catch-all.conf:/etc/nginx/x-catch-all.conf:ro
#      - ./docker/nginx-dev/default.conf:/etc/nginx/conf.d/default.conf:ro
      - ./public/:/var/www/html/public/:ro
      - ./public-dolly/:/var/www/html/public-dolly/:ro
#      - ./http_404.html:/usr/share/nginx/html/http_404.html:ro
#      - nginx-cache:/var/cache/nginx/
#      - nginx-pid:/var/run/
#      - nginx-log:/var/log/nginx/
#      - SCRIPT_DIR=/my/sub-folder/
#      - DOLLY_DIR=/dolly-sites/v2/
#volumes:
#  nginx-cache:
#  nginx-pid:
#  nginx-log:
